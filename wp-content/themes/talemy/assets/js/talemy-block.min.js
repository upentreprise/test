!function(e,i){"use strict";var t=function(e){return new t.init(e)};t.prototype.arrangeTabs=function(){var e=this.wrapper.find(".block-header"),t=e.find(".sf-heading"),a=e.find(".more-tabs"),r=e.find(".tabs-dropdown"),n=this.tabWrapper.width()+a.outerWidth()-e.width();if(600<i(window).width()&&(n=n+t.width()+30),0<n){for(var s=this.tabWrapper.children().length-1;0<=s&&(n-=this.tabWrapper.children().last().outerWidth(),r.prepend(this.tabWrapper.children().last()),!(n<0||0===n));s--);a.css("display","inline-block")}else if(n<0&&r.children().length){for(var o=r.children().length-1;0<=o&&(n+=r.children().first().outerWidth())<0;o--)this.tabWrapper.append(r.children().first());0===r.children().length&&a.hide()}this.tabWrapper.css("visibility","visible")},t.prototype.loadTabContent=function(a){var r=this;r.contentWrapper.removeClass("block-animated-short block-anim-fadeindown block-anim-fadeinleft block-anim-fadeinright"),r.contentWrapper.css("min-height",r.contentWrapper.height()+"px"),void 0!==r.cache[r.currentTabID]&&void 0!==r.cache[r.currentTabID][r.page[r.currentTabID]]?(r.contentWrapper.html(r.cache[r.currentTabID][r.page[r.currentTabID]]),r.contentWrapper.imagesLoaded(function(){r.contentWrapper.find(".equal-height").matchHeight(),r.animateContent(a),r.contentWrapper.css("min-height","")}),r.updateNextPrev(),r.updateLoadMore(),r.loadMoreScroll.length&&r.loadOnScroll(),r.processing=!1):i.ajax({url:talemy_js_data.ajax_url,type:"POST",dataType:"json",data:{action:"talemy_block_ajax_posts",action_type:a,atts:r.settings.atts,block_id:r.settings.block_id,page_number:r.page[r.currentTabID],query_args:r.settings.query_args,tab_id:r.currentTabID},beforeSend:function(){r.wrapper.addClass("block-loading")},success:function(e){if("tab"==a&&(r.page[r.currentTabID]=0,r.cache[r.currentTabID]={},r.maxPageNumber[r.currentTabID]={},"next_prev"==r.settings.atts.pagination?r.maxPageNumber[r.currentTabID]=Math.ceil(e.found_posts/r.settings.atts.count)-1:r.maxPageNumber[r.currentTabID]=Math.ceil((e.found_posts-r.settings.atts.count)/r.settings.atts.ppl)),e.html){var t=i(e.html).html();r.contentWrapper.html(t),r.contentWrapper.imagesLoaded(function(){r.contentWrapper.find(".equal-height").matchHeight(),r.contentWrapper.find("img").addClass("inview")}),r.cache[r.currentTabID][r.page[r.currentTabID]]=t}r.wrapper.removeClass("block-loading"),r.animateContent(a),r.contentWrapper.css("min-height","")}}).always(function(){r.updateNextPrev(),r.updateLoadMore(),r.loadMoreScroll.length&&r.loadOnScroll(),r.processing=!1})},t.prototype.loadPosts=function(){var t=this,a=t.page[t.currentTabID];i.ajax({url:talemy_js_data.ajax_url,type:"POST",dataType:"json",data:{action:"talemy_block_ajax_posts",action_type:"more",atts:t.settings.atts,block_id:t.settings.block_id,page_number:t.page[t.currentTabID],query_args:t.settings.query_args,tab_id:t.currentTabID},beforeSend:function(){t.wrapper.addClass("loading")},success:function(e){e.html&&(""===t.settings.atts.list_style?t.wrapper.find(".block-content").append(i(e.html).html()):t.wrapper.find(".block-content .post-list").append(i(e.html).children().html()),t.wrapper.imagesLoaded(function(){t.wrapper.find(".equal-height").matchHeight(),t.wrapper.find("img").addClass("inview")}),t.wrapper.removeClass("loading"),t.cache[t.currentTabID][a]=t.wrapper.find(".block-content").html())}}).always(function(){t.updateLoadMore(),t.processing=!1,t.maxPageNumber[t.currentTabID]>a&&a==t.settings.atts.max_loads&&(window.removeEventListener("scroll",t.loadOnScroll),i.ajax({url:talemy_js_data.ajax_url,type:"POST",data:{action:"talemy_ajax_more_button"},success:function(e){t.loadMoreScroll.remove(),t.footerWrapper.append(e),t.loadMore=t.footerWrapper.find(".load-more"),t.loadMore.on("click",function(){t.processing||(t.processing=!0,t.page[t.currentTabID]++,t.loadPosts())})}}))})},t.prototype.updateNextPrev=function(){if(0===this.maxPageNumber[this.currentTabID])return this.nextPrev.find(".prev-posts").addClass("disabled"),void this.nextPrev.find(".next-posts").addClass("disabled");0===this.page[this.currentTabID]?this.nextPrev.find(".prev-posts").addClass("disabled"):this.nextPrev.find(".prev-posts").removeClass("disabled"),this.maxPageNumber[this.currentTabID]==this.page[this.currentTabID]?this.nextPrev.find(".next-posts").addClass("disabled"):this.nextPrev.find(".next-posts").removeClass("disabled")},t.prototype.updateLoadMore=function(){this.maxPageNumber[this.currentTabID]===this.page[this.currentTabID]?this.loadMore.hide():this.loadMore.show()},t.prototype.animateContent=function(e){switch(e){case"next":this.contentWrapper.addClass("block-animated-short block-anim-fadeinleft");break;case"prev":this.contentWrapper.addClass("block-animated-short block-anim-fadeinright");break;default:this.contentWrapper.addClass("block-animated-short block-anim-fadeindown")}},t.init=function(e){var r=this;if(r.wrapper=i(e),0!==r.wrapper.length){if(r.settings=i(e).data("block")||{},r.tabWrapper=r.wrapper.find(".tabs-wrapper"),r.contentWrapper=r.wrapper.find(".block-content:first"),r.footerWrapper=r.wrapper.find(".block-footer"),r.loadMore=r.wrapper.find(".load-more"),r.nextPrev=r.wrapper.find(".load-next-prev-posts"),r.loadMoreScroll=r.wrapper.find(".load-more-scroll"),r.page={},r.cache={},r.maxPageNumber={},r.currentTabID=0,r.processing=!1,r.page[0]=0,r.cache[0]={},r.contentWrapper.length&&(r.cache[0][0]=r.contentWrapper.html()),r.tabWrapper.length){var t=r.wrapper.find(".block-preload-content");t.length&&(t.children().each(function(e){var t=i(this),a=t.data("content-id");a&&(r.page[a]=0,r.cache[a]={},r.cache[a][0]=t.html(),r.maxPageNumber[a]=t.data("max-pages"))}),t.remove()),r.tabWrapper.parent().on("click",".tab-item",function(e){if(e.preventDefault(),r.processing)return!1;r.processing=!0,r.contentWrapper.stop(),r.wrapper.find(".tab-item.active").removeClass("active");var t=i(this);t.addClass("active"),r.currentTabID=t.data("tab-id"),r.loadTabContent("tab")}),r.arrangeTabs(),r.tabWrapper.find(".tab-item").first().addClass("active"),i(window).on("resize orientationchange",i.debounce(200,function(){r.arrangeTabs()}))}r.nextPrev.length?(r.maxPageNumber[0]=r.settings.max_num_pages-1,r.updateNextPrev(),r.nextPrev.find(".next-posts").on("click",function(){r.processing||i(this).hasClass("disabled")||(r.processing=!0,r.page[r.currentTabID]++,r.loadTabContent("next"),r.updateNextPrev())}),r.nextPrev.find(".prev-posts").on("click",function(){r.processing||i(this).hasClass("disabled")||(r.processing=!0,r.page[r.currentTabID]--,r.loadTabContent("prev"),r.updateNextPrev())})):r.loadMore.length?(r.maxPageNumber[0]=Math.ceil((r.settings.found_posts-r.settings.atts.count)/r.settings.atts.ppl),r.updateLoadMore(),0!==r.settings.atts.ppl&&""!==r.settings.atts.ppl||(r.settings.atts.ppl=3),r.loadMore.on("click",r.footerWrapper,function(){r.processing||(r.processing=!0,r.page[r.currentTabID]++,r.loadPosts())})):r.loadMoreScroll.length&&(r.maxPageNumber[0]=Math.ceil((r.settings.found_posts-r.settings.atts.count)/r.settings.atts.ppl),0!==r.settings.atts.ppl&&""!==r.settings.atts.ppl||(r.settings.atts.ppl=5),r.maxPageNumber[0]>r.page[0]&&(r.loadOnScroll=i.debounce(100,function(){if(!r.processing){var e=i(window).scrollTop(),t=r.footerWrapper.offset().top-i(window).height(),a=r.footerWrapper.offset().top+200;t<=e&&e<a&&r.maxPageNumber[r.currentTabID]!==r.page[r.currentTabID]&&(r.processing=!0,r.page[r.currentTabID]++,r.loadPosts())}}),window.addEventListener("scroll",r.loadOnScroll,!1),r.loadOnScroll()))}},t.init.prototype=t.prototype,e.Talemy_Block=t}(window,jQuery);