!function(i){"use strict";var e=i(".ldcr-new__review");function t(a){a.addClass("filled"),a.prevAll().addClass("filled"),a.nextAll().removeClass("filled")}i(".ldcr-input__star").on("click",function(){var a=i(this);e.slideDown(),0!==a.index()?(a.siblings().removeClass("active"),a.addClass("active"),t(a)):a.next().click()}).on("mouseenter",function(){0!==i(this).index()&&t(i(this))}),i(".ldcr-input__stars").on("mouseleave",function(){var a=i(this).find(".active");0===a.length&&(a=i(this).children().eq(1)),t(a)}),i(".ldcr-review__form").on("submit",function(a){a.preventDefault();var e=i(this);i.ajax({url:ldcr_js_data.ajax_url,type:"POST",dataType:"json",data:{action:"ldcr_submit_review",course_id:e.data("course-id"),rating:e.find(".ldcr-input__star input:checked").val(),review:e.find("#ldcr-input__review").val(),headline:e.find("#ldcr-input__headline").val(),nonce:e.find("#ldcr_review_nonce").val()},beforeSend:function(){e.addClass("loading")},success:function(a){console.log(a),a.data.message&&(e.siblings(".ldcr-message").html(a.data.message),e.hide()),a.success&&a.data.publish&&window.location.reload()}}).always(function(){e.removeClass("loading")})});var s=null;function d(a){var e=i(".ldcr-reviews__items");0!==e.length&&(i("html,body").animate({scrollTop:e.offset().top-200},400),i.ajax({url:ldcr_js_data.ajax_url,type:"POST",dataType:"json",data:{action:"ldcr_load_reviews",count:e.data("count"),course_id:e.data("course-id"),page_number:a,filter_by_star:s},beforeSend:function(){e.parent().addClass("loading"),e.siblings(".ldcr-reviews__pagination").remove()},success:function(a){a.success?(a.data.items&&e.html(a.data.items),a.data.pagination&&e.after(a.data.pagination)):a.data.message&&e.html(a.data.message)}}).always(function(){e.parent().removeClass("loading")}))}i(document.body).on("click",".ldcr-stats__row:not(.disabled)",function(a){a.preventDefault();var e=i(this);if(!i(this).closest(".ldcr-reviews__summary").next().is(i(".ldcr-reviews__list")))return!1;"ldcr-clear"==a.target.className?(s=null,e.removeClass("active inactive"),e.siblings().removeClass("active inactive")):(s=e.data("filter"),e.removeClass("inactive").addClass("active"),e.siblings().addClass("inactive"),e.siblings().removeClass("active")),d(1)}).on("click.ldcr_page",".ldcr-page-number",function(a){a.preventDefault();var e=i(this),t=e.data("page"),s=e.siblings().length-1;if("prev"==t)t=2==(n=e.siblings(".current")).data("page")?1:n.prev().data("page");else if("next"==t){var n;t=(n=e.siblings(".current")).data("page")==s-1?s:n.next().data("page")}d(t)}).on("click",".ldcr-btn-vote:not(.disabled)",function(a){a.preventDefault();var e=i(this);e.addClass("disabled"),e.siblings(".ldcr-btn-vote").addClass("disabled"),i(document.body).hasClass("logged-in")||(window.location=e.attr("href"));var t=e.siblings(".ldcr-message"),s=e.data("action"),n=e.parents(".ldcr-review__item").data("id");i.ajax({url:ldcr_js_data.ajax_url,type:"POST",dataType:"json",data:{action:"ldcr_vote_review",id:n,vote:s,nonce:i("#ldcr_vote_nonce").val()},beforeSend:function(){"undo"!=s&&(e.parent().addClass("sending"),t.html(ldcr_js_data.sending_feedback))},success:function(a){e.parent().removeClass("sending"),a.success&&("undo"==a.data.vote?(e.parent().removeClass("upvoted downvoted"),e.hasClass("ldcr-upvote")&&(e.data("action","up"),e.removeClass("disabled"),e.siblings(".ldcr-btn-vote").data("action","down"),e.siblings(".ldcr-btn-vote").removeClass("disabled")),e.hasClass("ldcr-downvote")&&(e.data("action","down"),e.removeClass("disabled"),e.siblings(".ldcr-btn-vote").data("action","up"),e.siblings(".ldcr-btn-vote").removeClass("disabled"))):"up"==a.data.vote?e.parent().find(".ldcr-btn-vote").remove():"down"==a.data.vote&&e.parent().find(".ldcr-btn-vote").remove()),a.data.message?t.html(a.data.message):t.empty()}})})}(jQuery);